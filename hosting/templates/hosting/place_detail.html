{% extends 'hosting/base.html' %}
{% load i18n static %}

{% block page %}
    <div class="row place-detail">
        <div class="col-xs-12 col-md-6 owner">
            <div class="row">
                <div class="col-xs-3 avatar">
                    <a href="{{ place.owner.get_absolute_url }}">
                        <img src="{{ place.owner.avatar_url }}" />
                    </a>
                </div>
                <div class="col-xs-9">
                    <div class="row">
                        <p class="col-xs-8 name">
                            <a href="{{ place.owner.get_absolute_url }}">
                                {% if is_verbose_view %}
                                    {{ place.owner.full_name }}
                                {% else %}
                                    {{ place.owner.anonymous_name }}
                                {% endif %}
                            </a>
                        </p>
                        <p class="col-xs-4 status">
                            {% if user.is_authenticated %}
                                {% if place.available %}
                                    <span class="visible-xs-inline-block glyphicon glyphicon-stack-large" title="{% trans "available" %}">
                                        <span class="place-marker glyphicon-stackbit-2x glyphicon-home"></span>
                                        <span class="place-availability glyphicon-stackbit-1x glyphicon-ok"></span>
                                    </span>
                                    <em class="hidden-xs">{% trans "available" %}</em>
                                {% else %}
                                    <span class="visible-xs-inline-block glyphicon glyphicon-stack-large" title="{% trans "unavailable" %}">
                                        <span class="place-marker glyphicon-stackbit-2x glyphicon-home"></span>
                                        <span class="place-availability glyphicon-stackbit-1x glyphicon-remove"></span>
                                    </span>
                                    <em class="hidden-xs">{% trans "unavailable" %}</em>
                                {% endif %}
                            {% endif %}
                        </p>
                        {% if user.is_authenticated %}
                            <p class="col-xs-11 address">
                                {% if is_verbose_view and place.address %}
                                    {{ place.address.strip|linebreaksbr }}
                                    <br />
                                {% endif %}

                                {% include 'hosting/snippets/place_city_complete.html' with city=place.city closest_city=place.closest_city %}
                                <br />
                                {% if place.state_province %}
                                    {{ place.state_province }}
                                    <br />
                                {% endif %}
                                {% if is_verbose_view %}
                                    {{ place.postcode }}
                                {% endif %}
                                {{ place.get_country_display }}
                                
                                &nbsp; {% include 'hosting/snippets/checked.html' with object=place %}
                            </p>
                        {% endif %}

                        {% if is_verbose_view %}
                            {% for phone in place.owner.phones.all %}
                                <p class="col-xs-12">
                                    {{ phone.icon }}
                                    {% if phone.country %}
                                        <span title="{{ phone.get_country_display }}">({{ phone.country }})</span>
                                    {% endif %}
                                    <span style="white-space: nowrap">{{ phone.number.as_international }}</span>&nbsp;
                                    <br class="visible-xxs-inline" />
                                    <em><small>{{ phone.comments }}</small></em>
                                </p>
                            {% endfor %}
                        {% endif %}
                    </div>

                </div>
            </div>

            <div class="row">
            {% if user.is_authenticated %}
                <div class="col-md-12 hidden-xs hidden-sm">
                    {% if place.any_accommodation_details %}
                        <h3>{% trans "Description" %}</h3>
                        {% include 'hosting/snippets/place_description.html' with description=place.description contact_before=place.contact_before max_host=place.max_guest max_night=place.max_night %}
                    {% endif %}
                    {% if place.conditions.all %}
                        {% include 'hosting/snippets/place_conditions.html' with conditions=place.conditions.all %}
                    {% endif %}

                    {% if place.family_members.all and is_verbose_view %}
                        <h3>{% trans "Family members" %}</h3>
                        <ul>
                            {% for member in place.family_members.all %}
                                <li>
                                    {{ member.full_name }}
                                    {% if member.age %}
                                        ({{ member.age }})
                                    {% endif %}
                                </li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                </div>
            {% else %}
                {% include 'hosting/snippets/registration.html' %}
            {% endif %}
            </div>
        </div>

        <div class="col-xs-12 col-md-6 map">
                <iframe width="100%"
                    frameborder="0" scrolling="no" marginheight="0" marginwidth="0"
                    src="http://www.openstreetmap.org/export/embed.html?bbox={{ place.bbox }}{% if user.is_authenticated %}&amp;marker={{ place.latitude|stringformat:'f' }},{{ place.longitude|stringformat:'f' }}{% endif %}">
                </iframe>
        </div>

        {% if user.is_authenticated %}
            <div class="col-xs-12 hidden-md hidden-lg description-small">
                {% include 'hosting/snippets/place_description.html' with description=place.description contact_before=place.contact_before max_host=place.max_guest max_night=place.max_night %}
                {% if place.conditions.all %}
                    {% include 'hosting/snippets/place_conditions.html' with conditions=place.conditions.all %}
                {% endif %}
            </div>

            <p class="col-xs-12">
                {% if user.profile != place.owner %}
                    <a href="{% url 'postman_write' place.owner.user.username %}" class="btn btn-primary btn-vert-space">
                        <span class="glyphicon glyphicon-send"></span>&nbsp; {% trans "Write message" %}
                    </a>
                {% endif %}
                {% if user.profile == place.owner or user.is_staff %}
                    <span class="btn-group btn-vert-space">
                        <a href="{% url 'place_update' place.pk %}" class="btn btn-success" title="{% trans "Update" %}">
                            <span class="glyphicon glyphicon-pencil"></span> 
                            <span class="">{% trans "Update" %}</span>
                        </a>
                        <a href="{% url 'authorize_user' place.pk %}?next={{ request.get_full_path|urlencode }}" 
                           class="btn btn-warning"
                           title="{% trans "Authorizations" %}">
                            <span class="glyphicon glyphicon-eye-open"></span>
                            <span class="hidden-xxs">{% trans "Authorizations" %}</span>
                        </a>
                        {% if not is_verbose_view %}
                        {% if place.authorized_users.all or user.is_staff %}
                            <a href="{% url 'place_detail_verbose' place.pk %}" class="btn btn-primary" title="{% trans "View as an authorized user" %}">
                                <span class="glyphicon glyphicon-stack-normal" style="font-size: .8em">
                                    <span class="glyphicon-stackbit-1x glyphicon-eye-open"    style="top: -1.1ex"></span>
                                    <span class="glyphicon-stackbit-1x glyphicon-arrow-right" style="top: +0.5ex"></span>
                                </span>
                                <span class="hidden-xxs">{% trans "View" %}</span>
                            </a>
                        {% endif %}
                        {% endif %}
                    </span>
                {% endif %}
            </p>
        {% endif %}

        {% if user.is_authenticated %}
        {% if user.profile in place.family_members.all or user.profile == place.owner or user.is_staff %}
            <div class="col-xs-12">
                <p>
                    {% trans "Short description" %}:&nbsp; {{ place.short_description|default:"&ndash;" }}
                </p>
                <p>
                    {% trans "Available" %}:&nbsp; 
                    <span class="glyphicon glyphicon-{{ place.available|yesno:'ok,remove' }}"></span>
                    {{ place.available|yesno }}
                </p>
                <p>
                    {% trans "Print in book" %}:&nbsp; 
                    <span class="glyphicon glyphicon-{{ place.in_book|yesno:'ok,remove' }}"></span>
                    {{ place.in_book|yesno }}
                </p>
            </div>
        {% endif %}
        {% endif %}
    </div>
{% endblock page %}
